(function(m){function t(a,b){var c={};c[B+"transform"]="translate3d("+a+"px, "+b+"px, 0px)";this.jScrollBox.css(c);this.current={x:a,y:b};this.cfg.scrollbar&&M.apply(this)}function M(){var a=this.current,b={},c=this.wrapperSize,d=0,e=this.dir,f=this.barSize;1!==e&&(d=a.x/this.maxScrollWidth*(c.width-f.x),b[B+"transform"]="translate3d("+d+"px, 0px, 0px)",this.jBarX.css(b));0!==e&&(d=a.y/this.maxScrollHeight*(c.height-f.y),b[B+"transform"]="translate3d(0px, "+d+"px, 0px)",this.jBarY.css(b))}function C(a){function b(){d=
+new Date-c;r[k.cfg.animation]?(e=r[k.cfg.animation](d,h,m,g),f=r[k.cfg.animation](d,l,n,g)):(e=r.linear(d,h,m,g),f=r.linear(d,l,n,g));if(d>=g)e=a.x,f=a.y,t.call(k,e,f),k.jBox.removeClass("active"),k._isAdded=!1,k.cfg.onscrollend&&k.cfg.onscrollend.apply(k);else{t.call(k,e,f);var p=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||setTimeout)(b);k.timer=p}}var c=+new Date,d=0,e,f,g=a.duration,h=this.current.x,l=this.current.y,
m=a.x-h,n=a.y-l,k=this;b()}function p(){this.timer&&(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||clearTimeout)(this.timer)}function N(a){if(!this.cfg.ontouchstart||this.cfg.ontouchstart.apply(this)){p.apply(this);this.touched=!0;D.push(this);l=n=H(a);a=this.dir;var b=this.point,c=this.current;b.x=1===a?0:c.x;b.y=0===a?0:c.y;I=+new Date;E=!0;F=!1}}function J(a){if((e=D[0])&&e.touched){e._isAdded||(e.jBox.addClass("active"),
e._isAdded=!0);l=H(a);var b=e.dir,c=l.x-n.x,d=l.y-n.y,q=e.point;O.call(e,1===b?0:q.x+c,0===b?0:q.y+d);F||(Math.abs(c)<Math.abs(d)&&0===b&&(E=!1),F=!0);E&&a.preventDefault()}}function u(a){if(e){e.touched=!1;var b=l.x-n.x,c=l.y-n.y,d=e.point,q=e.cfg.deceleration,f=e.wrapperSize,g=e.dir;a=e.maxScrollWidth;var h=e.maxScrollHeight;if(0!==b||0!==c)v=+new Date-I,e.cfg.momentum&&300>v&&(b=1===g?{duration:0,destination:0}:K(d.x,d.x+b,v,e.maxScrollWidth,f.width,q),c=0===g?{duration:0,destination:0}:K(d.y,
d.y+c,v,e.maxScrollHeight,f.height,q),d=Math.max(b.duration,c.duration),b.destination=0<b.destination?(d+=300,0):b.destination<a?(d+=300,a):b.destination,c.destination=0<c.destination?(d+=300,0):c.destination<h?(d+=300,h):c.destination,e.scrollTo(b.destination,c.destination,d)),e.cfg.ontouchend&&e.cfg.ontouchend.apply(e),e=null,D=[]}}function K(a,b,c,d,e,f){b-=a;c=Math.abs(b)/c;var g;g=a+c*c/(2*f)*(0>b?-1:1);f=c/f;g<d?(g=e?d-e/2.5*(c/8):d,b=Math.abs(g-a),f=b/c):0<g&&(g=e?e/2.5*(c/8):0,b=Math.abs(a)+
g,f=b/c);return{destination:Math.round(g),duration:f}}function O(a,b){t.call(this,a,b)}function P(){var a=this;this.jScrollBox.on(h.start,function(b){N.call(a,b)});G||(m(document).on(h.move,J).on(h.end,u).on(h.cancel,u),G=!0)}function L(){var a,b,c,d,e,f;this.jScrollBox=this.jBox.children().eq(0);d={width:this.jBox.width(),height:this.jBox.height()};a=d.width-this.jScrollBox.width();b=d.height-this.jScrollBox.height();e=this.cfg.x||0;f=this.cfg.y||0;c=0>a?0>b?2:0:0>b?1:-1;-1!==c&&(this.dir=c,this.maxScrollWidth=
a,this.maxScrollHeight=b,this.wrapperSize=d,this.point={x:e,y:f},this.cfg.scrollbar&&(this.jBox.append('<div class="scrollbar-x scrollbar"><div class="bar"></div></div><div class="scrollbar-y scrollbar"><div class="bar"></div></div>'),this.jScrollBarX=this.jBox.find(".scrollbar-x"),this.jScrollBarY=this.jBox.find(".scrollbar-y"),this.barSize={x:d.width/-a*d.width,y:d.height/-b*d.height},this.jBarX=this.jScrollBarX.find(".bar").width(this.barSize.x),this.jBarY=this.jScrollBarY.find(".bar").height(this.barSize.y),
0===c&&this.jScrollBarY.remove(),1===c&&this.jScrollBarX.remove()),P.apply(this),w++,t.call(this,e,f))}function x(a,b){this.jBox=m(a);this.cfg=m.extend({},Q,b);L.apply(this);return this}var y="ontouchend"in document,z=window.PointerEvent||window.MSPointerEvent,A=function(a){return window.MSPointerEvent?"MSPointer"+a.charAt(9).toUpperCase()+a.substr(10):a},h={click:"click",start:y?z?A("pointerdown"):"touchstart":"mousedown",move:y?z?A("pointermove"):"touchmove":"mousemove",end:y?z?A("pointerup"):"touchend":
"mouseup",cancel:y?z?A("pointercancel"):"touchcancel":"mousecancel"},B=function(){var a=document.createElement("div").style,b="";""===a.WebkitTransform?b="-webkit-":""===a.MozTransform&&(b="-moz-");return b}(),r={"ease-out-back":function(a,b,c,d){return c*((a=a/d-1)*a*(2.70158*a+1.70158)+1)+b},"ease-out":function(a,b,c,d){return-c*(a/=d)*(a-2)+b},linear:function(a,b,c,d){return a/d*c+b}},Q={scrollbar:!0,momentum:!0,animation:"ease-out",deceleration:6E-4},e=null,D=[],n={},l={},I,v,G=!1,E=!1,F=!1,w=
0,H=function(a){a=a.originalEvent?a.originalEvent:a;var b=a.touches,c=0,d=0;b?(c=b[0].pageX,d=b[0].pageY):(c=a.clientX,d=a.clientY);return{x:c,y:d}};x.prototype={scrollTo:function(a,b,c){p.apply(this);C.call(this,{duration:c,x:a,y:b});this.jBox.addClass("active");this._isAdded=!0;return this},scrollXTo:function(a,b){p.apply(this);C.call(this,{duration:b,x:a,y:this.current.y});this.jBox.addClass("active");this._isAdded=!0;return this},scrollYTo:function(a,b){p.apply(this);C.call(this,{duration:b,x:this.current.x,
y:a});this.jBox.addClass("active");this._isAdded=!0;return this},refresh:function(a){var b=this.current.x,c=this.current.y;w--;this.jBox.find(".scrollbar").remove();this.cfg=m.extend(this.cfg,{x:b,y:c},a);L.apply(this);return this},destroy:function(){var a="";this.jBox.removeClass("active").off().find(".scrollbar").remove();for(a in this)delete this[a];this.__proto__=null;w--;0===w&&(m(document).off(h.move,J).off(h.end,u).off(h.cancel,u),G=!1)}};"function"===typeof define&&define.amd?define([],function(){return x}):
"undefined"!==typeof module&&module.exports?module.exports=x:window.NiceScroller=x})(window.jQuery||window.Zepto);